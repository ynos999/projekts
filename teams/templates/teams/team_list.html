{% extends "base.html" %}
{% block title %} {{title }} | {{block.super }}{% endblock %}


{% block content %}


    <!-- Default box -->
    <div class="card">
        <div class="card-header">
          <h3 class="card-title">Teams</h3>

          <div class="card-tools">
            <button type="button" class="btn btn-tool" data-card-widget="collapse" title="Collapse">
              <i class="fas fa-minus"></i>
            </button>
            <button type="button" class="btn btn-tool" data-card-widget="remove" title="Remove">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
        <div class="card-body p-0">
          <table class="table table-striped projects">
              <thead>
                  <tr>
                      <th style="width: 1%">
                          #
                      </th>
                      <th style="width: 20%">
                          Team Name
                      </th>
                      <th style="width: 30%">
                          Team Members
                      </th>
                     
                      
                      <th style="width: 20%">
                      </th>
                  </tr>
              </thead>
              <tbody>

                {% for team in teams %}
                  <tr>
                      <td>
                         {{ forloop.counter }}
                      </td>
                      <td>
                          <a href="">
                              {{ team.name }}
                          </a>
                          <br/>
                          <small>
                              Created {{ team.created_at }}
                          </small>
                      </td>
                      <td>
                        <ul class="list-inline m-0">
                            {% for member in team.members.all %}
                            <li class="list-inline-item">
                                <img alt="{{ member.username }}" 
                                    class="table-avatar" 
                                    src="{{ member.profile.profile_picture_url }}" 
                                    data-toggle="tooltip" 
                                    data-placement="top"
                                    title="{% if member.get_full_name %}{{ member.get_full_name }}{% else %}{{ member.username }}{% endif %}"
                                    style="width: 35px; height: 35px; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 1px 2px rgba(0,0,0,0.15); object-fit: cover; cursor: pointer;">
                            </li>
                            {% endfor %}
                        </ul>
                        <small class="text-muted">{{ team.members.count }} Participants</small>
                      </td>

                      <td class="project-actions text-right">
                          {# Pievienots nosacījums adminam #}
                          {% if request.user == team.created_by or request.user.is_superuser %}
                              <a href="{% url 'teams:team-update' team.pk %}" class="btn btn-info btn-sm">
                                  <i class="fas fa-pencil-alt"></i>
                                  Edit
                              </a>

                              <a href="{% url 'teams:team-delete' team.pk %}" class="btn btn-danger btn-sm">
                                  <i class="fas fa-trash"></i>
                                  Delete
                              </a>
                          {% endif %}
                      </td>
                    
                      
                      <!-- <td class="project-actions text-right">
                         
                        {% if request.user == team.created_by %}
                          <a href="{% url "teams:team-update" team.pk %}" class="btn btn-info btn-sm" href="#">
                              <i class="fas fa-pencil-alt">
                              </i>
                              Edit
                          </a>

                          
                           <a href="{% url "teams:team-delete" team.pk %}" class="btn btn-danger btn-sm" href="#">
                              <i class="fas fa-trash">
                              </i>
                              Delete
                          </a>
                          {% endif %}
                         
                      </td> -->
                  </tr>

                  {% endfor %}



              </tbody>
          </table>

       {% include "components/paginator.html" %}


        {% comment %} displaying messages {% endcomment %}
            {% if messages %}
            <div class="messages col-10">
              {% for message in messages %}
              <div class="alert {% if message.tags %}alert-{{message.tags}}{% else %}alert-info{% endif %}">
                {{ message }}
              </div>
              
              {% endfor %}

            </div>
            
            {% endif %}

       


        </div>
        <!-- /.card-body -->
      </div>
      <!-- /.card -->

{% endblock  %}

{% block script %}
<script>
  $(function () {
    // Pārbaudām vai tooltip funkcija eksistē, lai izvairītos no JS kļūdām
    if ($.fn.tooltip) {
        $('[data-toggle="tooltip"]').tooltip();
    }
  });
</script>
{% endblock %}
