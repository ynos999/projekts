{% extends "base.html" %}
{% block title %} {{title }} | {{block.super }}{% endblock %}


{% block content %}


    <!-- Default box -->

    <div class="card-header">
        <div class="row">
            <div class="col-md-8">
                <form method="get" class="input-group input-group-sm" style="width: 350px;">
                    <input type="text" name="q" class="form-control float-right" 
                          placeholder="Meklēt projektu, aprakstu vai datumu..." 
                          value="{{ search_query }}">

                    <div class="input-group-append">
                        <button type="submit" class="btn btn-default">
                            <i class="fas fa-search"></i>
                        </button>
                        {% if search_query %}
                            <a href="{% url 'projects:list' %}" class="btn btn-default">
                                <i class="fas fa-times"></i>
                            </a>
                        {% endif %}
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
          <h3 class="card-title">Projects</h3>
          
          <div class="card-tools">
            <button type="button" class="btn btn-tool" data-card-widget="collapse" title="Collapse">
              <i class="fas fa-minus"></i>
            </button>
            <button type="button" class="btn btn-tool" data-card-widget="remove" title="Remove">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
        <div class="card-body p-0">
          <table class="table table-striped projects">
              <thead>
                  <tr>
                      <th style="width: 1%">
                          #
                      </th>
                      <th style="width: 20%">
                          Project Name
                      </th>
                      <th style="width: 20%">
                          Team Members
                      </th>

                      <th style="width: 10%">
                          Leader
                      </th>

                      <th>
                          Project Progress
                      </th>
                      <th style="width: 8%" class="text-center">
                          Priority
                      </th>
                      <!-- <th style="width: 20%">
                      </th> -->
                      <th style="width: 8%">
                        Deadline
                      </th>
                      <th style="width: 15%" class="text-center">
                        Actions
                      </th>
                  </tr>
              </thead>
              <tbody>

                {% for project in projects %}
                  <tr>
                      <td>
                         {{ forloop.counter }}
                      </td>
                      <td>
                          <a href="{% url "projects:project-detail" project.id %}">
                              {{ project.name }}
                          </a>
                          <br/>
                          <small>
                              Created {{ project.start_date }}
                          </small>
                      </td>
                      <td>
                          <ul class="list-inline">
                            <!-- {% for member in project.team.members.all %}
                              <li class="list-inline-item" title="{{ member.username }}">
                                  <img alt="Avatar" class="table-avatar" src="{{ member.profile.profile_picture_url }}" style="width: 30px; height: 30px; border-radius: 50%;">
                                  <span class="small ml-1">{{ member.username }}</span>
                              </li>
                            {% endfor %} -->

                            {% for member in project.team.members.all %}
                            <li class="list-inline-item">
                                <img alt="{{ member.username }}" 
                                    class="table-avatar" 
                                    src="{{ member.profile.profile_picture_url }}" 
                                    data-toggle="tooltip" 
                                    data-placement="top"
                                    title="{% if member.get_full_name %}{{ member.get_full_name }}{% else %}{{ member.username }}{% endif %}"
                                    style="width: 35px; height: 35px; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 1px 2px rgba(0,0,0,0.15); object-fit: cover; cursor: pointer;">
                            </li>
                            {% endfor %}
                          </ul>

                      </td>

                      <td>
                            <!-- <div class="d-flex align-items-center">
                                <img alt="Avatar" class="table-avatar" 
                                    src="{{ project.owner.profile.profile_picture_url }}" 
                                    style="width: 35px; height: 35px; border-radius: 50%; border: 2px solid #17a2b8;">
                                <span class="small ml-2"><strong>{{ project.owner.username }}</strong></span>
                            </div> -->
                            <li class="list-inline-item">
                                <img alt="{{ member.username }}" 
                                    class="table-avatar" 
                                    src="{{ project.owner.profile.profile_picture_url }}" 
                                    data-toggle="tooltip" 
                                    data-placement="top"
                                    title="{% if member.get_full_name %}{{ member.get_full_name }}{% else %}{{ project.owner.username }}{% endif %}"
                                    style="width: 35px; height: 35px; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 1px 2px rgba(0,0,0,0.15); object-fit: cover; cursor: pointer;">
                            </li>
                      </td>

                      <td class="project_progress">
                          <div class="progress progress-sm">
                              <div class="progress-bar bg-{{project.status_color}}" role="progressbar" aria-valuenow="{{ project.progress}}" aria-valuemin="0" aria-valuemax="100" style="width: {{project.progress}}%">
                              </div>
                          </div>
                          <small>
                            {{ project.progress}}% Complete
                          </small>
                      </td>
                      <td class="project-state">
                          <span class="badge badge-{{ project.priority_color }}">{{ project.priority }}</span>
                      </td>

                      <td>
                          <span class="badge badge-info">
                              <i class="far fa-calendar-alt"></i> {{ project.due_date|date:"d.m.Y" }}
                          </span>
                      </td>

                      <td class="project-actions text-right">

                        {% if request.user == project.owner %}
                          <a href="{% url "projects:update" project.pk %}" class="btn btn-info btn-sm" href="#">
                              <i class="fas fa-pencil-alt">
                              </i>
                              Edit
                          </a>

                           <a href="{% url "projects:delete" project.pk %}" class="btn btn-danger btn-sm" href="#">
                              <i class="fas fa-trash">
                              </i>
                              Delete
                          </a>
                          {% endif %}
                         
                      </td>
                  </tr>

                  {% endfor %}



              </tbody>
          </table>

       {% include "components/paginator.html" %}


        {% comment %} displaying messages {% endcomment %}
            {% if messages %}
            <div class="messages col-10">
              {% for message in messages %}
              <div class="alert {% if message.tags %}alert-{{message.tags}}{% else %}alert-info{% endif %}">
                {{ message }}
              </div>
              
              {% endfor %}

            </div>
            
            {% endif %}

       


        </div>
        <!-- /.card-body -->
      </div>
      <!-- /.card -->

{% endblock  %}

{% block script %}
<script>
  $(function () {
    // Pārbaudām vai tooltip funkcija eksistē, lai izvairītos no JS kļūdām
    if ($.fn.tooltip) {
        $('[data-toggle="tooltip"]').tooltip();
    }
  });
</script>
{% endblock %}