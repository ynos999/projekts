<!DOCTYPE html>
<html lang="en">
    {% load static %}
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}Projekti{% endblock %}</title>

{% include "components/css.html" %}

{% block page_css %}

{% endblock  %}

<script crossorigin="anonymous" integrity="sha384-xBuQ/xzmlsLoJpyjoggmTEz8OWUFM0/RC5BsqQBDX2v5cMvDHcMakNTNrHIW2I5f" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
{{ form.media }}

</head>
<body class="hold-transition dark-mode sidebar-mini layout-fixed layout-navbar-fixed layout-footer-fixed">
<div class="wrapper">

  <!-- Preloader -->
  <div class="preloader flex-column justify-content-center align-items-center">
    <img class="animation__wobble" src="{% static "dist/img/AdminLTELogo.png" %}" alt="AdminLTELogo" height="60" width="60">
  </div>

  <!-- Navbar -->
  {% include "components/navbar.html" %}
  <!-- /.navbar -->

  <!-- Main Sidebar Container -->
 {% include "components/sidebar.html" %}

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper {% if is_kanban %}kanban{% endif %}">
    <!-- Content Header (Page header) -->
    {% include "components/header_content.html" %}
    <!-- /.content-header -->

    <!-- Main content -->
    <section class="content">

      <div class="container-fluid">
          {% if messages %}
              {% for message in messages %}
                  <div class="alert alert-{% if message.tags == 'error' %}danger{% elif message.tags == 'success' %}success{% else %}info{% endif %} alert-dismissible">
                      <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                      <h5><i class="icon fas {% if message.tags == 'error' %}fa-ban{% elif message.tags == 'success' %}fa-check{% else %}fa-info{% endif %}"></i> Uzmanību!</h5>
                      {{ message }}
                  </div>
              {% endfor %}
          {% endif %}
      </div>
      {% block content %}
      
      {% endblock %}
    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->

  <!-- Main Footer -->
  {% include "components/footer.html" %}
</div>
<!-- ./wrapper -->

{% include "components/javascript.html" %}

{% block script %}
<script>
    function checkNotifications() {
        // Mēs vēršamies pie jauna URL, ko tūlīt izveidosim
        fetch('/notifications/unread-count/') 
            .then(response => {
                if (!response.ok) throw new Error('Network error');
                return response.json();
            })
            .then(data => {
                // Atrod skaitītāju. Atkarībā no Tava navbar, 
                // ID var būt 'notification-badge' vai klase '.navbar-badge'
                const badge = document.getElementById('notification-badge') || document.querySelector('.navbar-badge');
                
                if (badge) {
                    badge.innerText = data.unread_count;
                    
                    // Ja jaunu paziņojumu nav, paslēpjam skaitītāju, ja ir - parādām
                    if (data.unread_count > 0) {
                        badge.style.display = 'inline-block';
                    } else {
                        badge.style.display = 'none';
                    }
                }
            })
            .catch(error => console.error('Error:', error));
    }

    // Pārbaudīt ik pēc 30 sekundēm
    setInterval(checkNotifications, 30000);
    
    // Pārbaudīt arī uzreiz, kad lapa ielādējas
    document.addEventListener('DOMContentLoaded', checkNotifications);
</script>
{% endblock %}
</body>
</html>



