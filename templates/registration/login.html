{% extends "registration/auth_base.html" %}
{% block title %}Login | {{ block.super }}{% endblock %}
{% load crispy_forms_tags %}

{% block content %}
<script src="https://www.google.com/recaptcha/api.js?render=6LcS3j8sAAAAAHOQCbi4c7iQOGHvJMdC8h1oLgRO"></script>
<div class="card-body">
  <p class="login-box-msg">Sign in to start your session</p>

  <form id="login-form" action="" method="post">
      {% csrf_token %}
      
      {{ form.media }}<div class="card-body"></div>  {{ form|crispy }}
      
      <div class="mt-4">

        <button type="submit" id="submit-btn" class="btn btn-primary btn-block shadow-sm position-relative">
          <span id="btn-text">Login</span>
          <div id="btn-spinner" class="d-none position-absolute" style="top: 50%; left: 50%; transform: translate(-50%, -50%);">
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          </div>
        </button>

      </div>
  </form>
</div>

<script>
  // Izmantojam addEventListener, lai netraucētu Captcha darbībai
  document.getElementById('login-form').addEventListener('submit', function(e) {
    if (this.checkValidity()) {
      const btnText = document.getElementById('btn-text');
      const btnSpinner = document.getElementById('btn-spinner');
      const submitBtn = document.getElementById('submit-btn');

      btnText.classList.add('invisible');
      btnSpinner.classList.remove('d-none');
      
      // Svarīgi: neizmantojam .disabled = true, lai nepārtrauktu Captcha datu sūtīšanu
      submitBtn.style.pointerEvents = 'none';
      submitBtn.style.opacity = '0.7';
    }
  });
  
</script>
{% endblock %}